<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TDSP â€” Test Data Standardization Platform</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#08090c;--card:#0f1117;--elevated:#161820;--input:#111318;
  --border:#1c1f2a;--border2:#2a2e3a;
  --t1:#e8ecf4;--t2:#8a92a6;--t3:#505668;
  --accent:#e8590c;--accent2:#ff6b1a;
  --pass:#22c55e;--pass-bg:#0a1f14;--pass-b:#14532d;
  --fail:#ef4444;--fail-bg:#1f0a0a;--fail-b:#7f1d1d;
  --cond:#eab308;--cond-bg:#1f1a0a;--cond-b:#713f12;
  --blue:#3b82f6;--purple:#a855f7;
  --mono:'JetBrains Mono',monospace;
  --sans:'DM Sans','Noto Sans KR',sans-serif;
  --kr:'Noto Sans KR','DM Sans',sans-serif;
}
html{scroll-behavior:smooth}
body{font-family:var(--kr);background:var(--bg);color:var(--t1);line-height:1.5;min-height:100vh;-webkit-font-smoothing:antialiased}
input,select,textarea,button{font-family:inherit}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}

@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes spin{to{transform:rotate(360deg)}}

/* Header */
.hdr{position:sticky;top:0;z-index:100;background:rgba(8,9,12,.88);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);padding:0 24px;height:54px;display:flex;align-items:center;justify-content:space-between}
.logo{display:flex;align-items:center;gap:9px}
.logo svg{color:var(--accent)}
.logo b{font-family:var(--sans);font-size:16px;color:var(--accent);letter-spacing:-.03em}
.logo span{color:var(--t3);font-size:12px}
.nav{display:flex;align-items:center;gap:3px}
.nbtn{display:flex;align-items:center;gap:5px;padding:6px 13px;background:0;border:1px solid transparent;border-radius:6px;color:var(--t3);font-size:12.5px;font-weight:500;cursor:pointer;transition:.15s}
.nbtn:hover{color:var(--t2);background:var(--elevated)}
.nbtn.on{color:var(--t1);background:var(--elevated);border-color:var(--border)}
.nbtn svg{width:15px;height:15px}
.ubtn{display:flex;align-items:center;gap:5px;padding:7px 15px;background:linear-gradient(135deg,var(--accent),#c2410c);border:0;border-radius:7px;color:#fff;font-size:12.5px;font-weight:600;cursor:pointer;margin-left:8px;box-shadow:0 2px 10px #e8590c33;transition:.15s}
.ubtn:hover{transform:translateY(-1px);box-shadow:0 4px 16px #e8590c44}
.ubtn svg{width:15px;height:15px}

/* Main */
.main{max-width:1260px;margin:0 auto;padding:24px}

/* Banner */
.banner{display:flex;align-items:center;gap:8px;padding:10px 14px;border-radius:7px;font-size:12.5px;margin-bottom:18px;animation:fadeUp .3s ease}
.banner.ok{background:var(--pass-bg);border:1px solid var(--pass-b);color:var(--pass)}
.banner.err{background:var(--fail-bg);border:1px solid var(--fail-b);color:var(--fail)}
.banner.info{background:#0a1530;border:1px solid #1e3a5f;color:var(--blue)}

/* Stats */
.stats{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:20px}
.st{background:var(--card);border:1px solid var(--border);border-radius:9px;padding:16px 18px;animation:fadeUp .4s ease both}
.st:nth-child(2){animation-delay:.05s}.st:nth-child(3){animation-delay:.1s}.st:nth-child(4){animation-delay:.15s}.st:nth-child(5){animation-delay:.2s}
.st-l{font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:var(--t3);margin-bottom:4px;font-weight:500}
.st-v{font-family:var(--sans);font-size:28px;font-weight:700;letter-spacing:-.04em}

/* Toolbar */
.toolbar{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap;align-items:center}
.dlbtn{display:flex;align-items:center;gap:5px;padding:7px 12px;background:var(--elevated);border:1px solid var(--border);border-radius:6px;color:var(--t2);font-size:12px;font-weight:500;cursor:pointer;transition:.15s}
.dlbtn:hover{border-color:var(--accent);color:var(--accent)}
.dlbtn svg{width:13px;height:13px}

/* Search */
.sbar{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;align-items:center}
.swrap{display:flex;align-items:center;gap:8px;background:var(--input);border:1px solid var(--border);border-radius:7px;padding:0 12px;flex:1 1 260px;transition:.2s}
.swrap:focus-within{border-color:var(--accent)}
.swrap svg{color:var(--t3);width:15px;height:15px;flex-shrink:0}
.sinput{background:0;border:0;outline:0;color:var(--t1);padding:10px 0;font-size:12.5px;width:100%}
.sinput::placeholder{color:var(--t3)}
.fsel{background:var(--input);border:1px solid var(--border);border-radius:7px;color:var(--t2);padding:10px 12px;font-size:12.5px;cursor:pointer;outline:0}
.vtog{display:flex;border:1px solid var(--border);border-radius:7px;overflow:hidden}
.vtog button{padding:8px 10px;background:var(--input);border:0;color:var(--t3);cursor:pointer;display:flex;transition:.15s}
.vtog button.on{background:var(--elevated);color:var(--t1)}
.vtog button svg{width:15px;height:15px}
.rcnt{color:var(--t3);font-size:11.5px;margin-bottom:12px}

/* Badges */
.bdg{display:inline-flex;align-items:center;gap:3px;padding:2px 9px;border-radius:5px;font-size:11px;font-weight:600;letter-spacing:.02em}
.bdg svg{width:11px;height:11px}
.bdg-p{background:var(--pass-bg);color:var(--pass);border:1px solid var(--pass-b)}
.bdg-f{background:var(--fail-bg);color:var(--fail);border:1px solid var(--fail-b)}
.bdg-c{background:var(--cond-bg);color:var(--cond);border:1px solid var(--cond-b)}
.fmt{display:inline-flex;align-items:center;gap:3px;padding:2px 7px;border-radius:4px;font-size:10.5px;font-weight:500}
.fmt-ppt{background:#1a1230;color:#c084fc;border:1px solid #581c87}
.fmt-xls{background:#0a1f14;color:#4ade80;border:1px solid #14532d}
.fmt-doc{background:#0a1530;color:#60a5fa;border:1px solid #1e3a5f}

/* Card Grid */
.cgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:11px}
.tcard{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:18px;cursor:pointer;transition:.2s;animation:fadeUp .35s ease both}
.tcard:nth-child(2){animation-delay:.04s}.tcard:nth-child(3){animation-delay:.08s}.tcard:nth-child(4){animation-delay:.12s}
.tcard:hover{border-color:var(--border2);transform:translateY(-2px);box-shadow:0 6px 20px #0006}
.ch{display:flex;justify-content:space-between;align-items:start;margin-bottom:8px}
.ct{font-size:13.5px;font-weight:600;font-family:var(--mono);margin-bottom:1px}
.cs{font-size:11.5px;color:var(--t3)}
.cm{display:flex;gap:6px;align-items:center;margin-bottom:10px;flex-wrap:wrap;font-size:11.5px;color:var(--t3)}
.cm .sep{color:var(--border)}
.mrow{display:flex;justify-content:space-between;padding:2px 0;font-size:11.5px;color:var(--t3)}
.mval{font-family:var(--mono);font-size:11px}
.tags{display:flex;gap:4px;flex-wrap:wrap}
.tag{padding:2px 8px;border-radius:9px;font-size:10px;font-weight:500;background:var(--bg);color:var(--t3);border:1px solid var(--border)}

/* Table */
.twrap{background:var(--card);border:1px solid var(--border);border-radius:12px;overflow-x:auto;animation:fadeUp .35s ease}
.dtbl{width:100%;border-collapse:collapse}
.dtbl th{padding:11px 14px;text-align:left;color:var(--t3);font-size:10px;text-transform:uppercase;letter-spacing:.06em;font-weight:500;border-bottom:1px solid var(--border);white-space:nowrap}
.dtbl td{padding:12px 14px;font-size:12.5px;border-bottom:1px solid #12141c;white-space:nowrap}
.dtbl tbody tr{cursor:pointer;transition:.1s}
.dtbl tbody tr:hover{background:var(--elevated)}

/* Detail */
.dbk{display:inline-flex;align-items:center;gap:5px;background:0;border:0;color:var(--accent);font-size:12.5px;cursor:pointer;padding:0;margin-bottom:18px;font-weight:500}
.dbk:hover{color:var(--accent2)}
.dh{display:flex;align-items:center;gap:12px;margin-bottom:24px;flex-wrap:wrap}
.dh h2{font-family:var(--mono);font-size:20px;font-weight:700}
.dgrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.dsec{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:20px}
.dsec.full{grid-column:1/-1}
.stit{font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:var(--t3);font-weight:600;margin-bottom:12px}
.irow{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #12141c;font-size:12.5px}
.irow:last-child{border-bottom:0}
.ilbl{color:var(--t3)}.ival{color:var(--t1)}.ival.m{font-family:var(--mono);font-size:12px}
.mtbl{width:100%;border-collapse:collapse}
.mtbl th{padding:7px 10px;text-align:left;color:var(--t3);font-size:10px;text-transform:uppercase;letter-spacing:.05em;font-weight:500;border-bottom:1px solid var(--border)}
.mtbl td{padding:9px 10px;font-size:12.5px;border-bottom:1px solid #12141c}
.flink{display:flex;align-items:center;gap:7px;padding:7px 0;color:var(--blue);font-size:12.5px;cursor:pointer;border-bottom:1px solid #12141c}
.flink:last-child{border-bottom:0}
.ntxt{color:var(--t2);font-size:13px;line-height:1.7}

/* Modal */
.moverlay{position:fixed;inset:0;background:#000b;backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;z-index:1000;animation:fadeIn .2s}
.moverlay.show{display:flex}
.modal{background:var(--card);border:1px solid var(--border);border-radius:14px;width:92%;max-width:620px;max-height:82vh;overflow:auto;box-shadow:0 20px 50px #0008}
.mhdr{padding:16px 22px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.mhdr h3{font-family:var(--sans);font-size:15px;font-weight:600}
.mcls{background:0;border:0;color:var(--t3);font-size:17px;cursor:pointer;padding:4px}
.mbody{padding:22px}
.fg{margin-bottom:14px}
.fl{display:block;font-size:12px;color:var(--t2);margin-bottom:4px;font-weight:500}
.fi{width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--t1);padding:9px 12px;font-size:12.5px;outline:0;transition:.2s}
.fi:focus{border-color:var(--accent)}
.frow{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.fta{width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--t1);padding:9px 12px;font-size:12px;outline:0;min-height:70px;resize:vertical;font-family:var(--mono)}
.fsub{width:100%;padding:12px;background:linear-gradient(135deg,var(--accent),#c2410c);border:0;border-radius:7px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;margin-top:6px;transition:.15s}
.fsub:hover{transform:translateY(-1px)}
.fsub:disabled{opacity:.5;cursor:not-allowed;transform:none}

/* Config */
.csec{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:22px;animation:fadeUp .4s ease}
.clbl{display:block;font-size:12.5px;color:var(--t2);margin-bottom:5px;font-weight:500}
.cinp{width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--t1);padding:9px 12px;font-size:12.5px;outline:0;margin-bottom:12px;font-family:var(--mono);transition:.2s}
.cinp:focus{border-color:var(--accent)}
.chint{font-size:11px;color:var(--t3);margin-top:-6px;margin-bottom:12px;line-height:1.5}
.cbtn{padding:10px 22px;background:linear-gradient(135deg,var(--accent),#c2410c);border:0;border-radius:7px;color:#fff;font-size:13px;font-weight:600;cursor:pointer}

/* Schema */
.sctbl{width:100%;border-collapse:collapse}
.sctbl th{padding:9px 12px;text-align:left;color:var(--t3);font-size:10px;text-transform:uppercase;letter-spacing:.06em;font-weight:500;border-bottom:1px solid var(--border)}
.sctbl td{padding:10px 12px;font-size:12.5px;border-bottom:1px solid #12141c}
.scf{color:var(--accent);font-family:var(--mono);font-size:12px}
.sct{display:inline-block;padding:2px 8px;background:var(--bg);border:1px solid var(--border);border-radius:4px;font-size:10.5px;color:var(--t2)}
.scr{color:var(--accent);font-size:11px}

/* Pipeline */
.pflow{display:flex;align-items:center;justify-content:center;gap:6px;flex-wrap:wrap;padding:16px 0}
.pstep{background:var(--bg);border:1px solid var(--border);border-radius:11px;padding:22px 18px;text-align:center;min-width:130px;transition:.2s}
.pstep:hover{transform:translateY(-2px);border-color:var(--border2)}
.pico{font-size:30px;margin-bottom:8px}
.ptit{font-size:12.5px;font-weight:600;margin-bottom:3px}
.pdsc{font-size:10.5px;color:var(--t3);line-height:1.4}
.parr{color:var(--border);font-size:20px}

/* Arch */
.agrid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:16px}
.acard{background:var(--bg);border:1px solid var(--border);border-radius:9px;padding:18px}
.atit{font-size:12.5px;font-weight:600;margin-bottom:6px;display:flex;align-items:center;gap:7px}
.atit svg{width:15px;height:15px}
.adsc{font-size:11.5px;color:var(--t3);line-height:1.6}
.adsc code{background:var(--elevated);padding:1px 6px;border-radius:3px;font-family:var(--mono);font-size:10.5px;color:var(--accent)}
pre.codeblock{background:var(--bg);border:1px solid var(--border);border-radius:7px;padding:14px;overflow-x:auto;font-family:var(--mono);font-size:11.5px;color:var(--t2);line-height:1.7;margin-top:14px}

/* Spinner */
.spin{width:16px;height:16px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .6s linear infinite;display:inline-block;vertical-align:middle}

/* Responsive */
@media(max-width:768px){
  .stats{grid-template-columns:repeat(3,1fr)}
  .dgrid,.agrid{grid-template-columns:1fr}
  .cgrid{grid-template-columns:1fr}
  .hdr{padding:0 12px}.main{padding:14px}
  .logo span{display:none}
  .pflow{flex-direction:column}.parr{transform:rotate(90deg)}
  .frow{grid-template-columns:1fr}
}
</style>
</head>
<body>

<header class="hdr">
  <div class="logo">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>
    <b>TDSP</b>
    <span>Test Data Standardization Platform</span>
  </div>
  <div class="nav" id="navBar"></div>
</header>

<main class="main">
  <div id="banner" style="display:none"></div>
  <div id="content"></div>
</main>

<div class="moverlay" id="uploadModal">
  <div class="modal">
    <div class="mhdr"><h3 id="modalTitle">í…ŒìŠ¤íŠ¸ ë°ì´í„° ë“±ë¡</h3><button class="mcls" onclick="closeModal()">âœ•</button></div>
    <div class="mbody" id="modalBody"></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•â•â•â•
let DATA=[], FILTERED=[], VIEW='dashboard', VMODE='grid';
let CFG={owner:'',repo:'',branch:'main',path:'data/tests.json',token:''};
try{Object.assign(CFG,JSON.parse(localStorage.getItem('tdsp_cfg')||'{}'))}catch(e){}

// â•â•â•â•â•â•â•â•â•â• SAMPLE DATA â•â•â•â•â•â•â•â•â•â•
const SAMPLE=[
  {test_id:"GSU-FUNC-2026-001",project_name:"Galaxy S26 Ultra",test_type:"Functional",test_date:"2026-01-15",dut_info:{model:"SM-S926B",serial:"R5CX20ABC01",fw_version:"S926BXXU1AXAA"},test_conditions:{temperature:"25Â°C",humidity:"50%RH",voltage:"4.2V"},result_summary:"Pass",measurements:[{item:"Boot Time",value:2.3,unit:"sec",spec:"< 3.0",verdict:"Pass"},{item:"Touch Response",value:12,unit:"ms",spec:"< 20",verdict:"Pass"}],engineer_name:"ë³€ì¢…íƒ",original_files:["GSU_Functional_Report_v1.pptx"],tags:["Galaxy","S26","Functional","Boot"],notes:"ì •ìƒ ë™ì‘ í™•ì¸. íŠ¹ì´ì‚¬í•­ ì—†ìŒ.",source_format:"PPT"},
  {test_id:"GSU-PERF-2026-002",project_name:"Galaxy S26 Ultra",test_type:"Performance",test_date:"2026-01-18",dut_info:{model:"SM-S926B",serial:"R5CX20ABC02",fw_version:"S926BXXU1AXAA"},test_conditions:{temperature:"40Â°C",humidity:"85%RH",voltage:"3.8V"},result_summary:"Conditional",measurements:[{item:"CPU Benchmark",value:4250,unit:"score",spec:"> 4000",verdict:"Pass"},{item:"GPU Render",value:58,unit:"fps",spec:"> 60",verdict:"Fail"},{item:"Memory Speed",value:72.5,unit:"GB/s",spec:"> 70",verdict:"Pass"}],engineer_name:"ë³€ì¢…íƒ",original_files:["GSU_Performance_Test_v2.xlsx"],tags:["Galaxy","S26","Performance","GPU","High-Temp"],notes:"ê³ ì˜¨ í™˜ê²½ì—ì„œ GPU ì„±ëŠ¥ ì†Œí­ ì €í•˜. ì¬í…ŒìŠ¤íŠ¸ í•„ìš”.",source_format:"Excel"},
  {test_id:"GTS-REL-2026-003",project_name:"Galaxy Tab S10",test_type:"Reliability",test_date:"2026-02-01",dut_info:{model:"SM-X926B",serial:"R5TX30DEF01",fw_version:"X926BXXU1AXBA"},test_conditions:{temperature:"-10Â°C ~ 60Â°C",cycles:"500",humidity:"10~90%RH"},result_summary:"Pass",measurements:[{item:"Thermal Cycle",value:500,unit:"cycles",spec:"> 300",verdict:"Pass"},{item:"Display Integrity",value:0,unit:"defects",spec:"= 0",verdict:"Pass"}],engineer_name:"ê¹€ë¯¼ìˆ˜",original_files:["GTS_Reliability_Report.docx"],tags:["Tab","S10","Reliability","Thermal"],notes:"500 ì‚¬ì´í´ ì™„ë£Œ. ì™¸ê´€ ë° ê¸°ëŠ¥ ì´ìƒ ì—†ìŒ.",source_format:"Word"},
  {test_id:"GBP-EMC-2026-004",project_name:"Galaxy Buds4 Pro",test_type:"EMC",test_date:"2026-02-05",dut_info:{model:"SM-R640",serial:"R5BX10GHI01",fw_version:"R640XXU1AXCA"},test_conditions:{standard:"EN 55032",frequency:"30MHz-6GHz"},result_summary:"Fail",measurements:[{item:"Radiated Emission",value:-38,unit:"dBm",spec:"< -40",verdict:"Fail"},{item:"Conducted Emission",value:-52,unit:"dBm",spec:"< -50",verdict:"Fail"}],engineer_name:"ë³€ì¢…íƒ",original_files:["GBP_EMC_Test_Report.pptx"],tags:["Buds","EMC","Emission","Fail"],notes:"ë°©ì‚¬/ì „ë„ ë°©ì¶œ ê¸°ì¤€ ì´ˆê³¼. ì°¨í ì„¤ê³„ ë³€ê²½ í•„ìš”.",source_format:"PPT"},
  {test_id:"GW7-ENV-2026-005",project_name:"Galaxy Watch7",test_type:"Environmental",test_date:"2026-02-08",dut_info:{model:"SM-L705",serial:"R5WX20JKL01",fw_version:"L705XXU1AXDA"},test_conditions:{test:"IP68 Submersion",depth:"1.5m",duration:"30min"},result_summary:"Pass",measurements:[{item:"Water Ingress",value:0,unit:"ml",spec:"= 0",verdict:"Pass"},{item:"Post-test Function",value:100,unit:"%",spec:"= 100",verdict:"Pass"}],engineer_name:"ì´ì§€ì˜",original_files:["GW7_IP68_Report.xlsx"],tags:["Watch","IP68","Waterproof","Environmental"],notes:"IP68 ê¸°ì¤€ ì¶©ì¡±. 30ë¶„ ì¹¨ìˆ˜ í›„ ì •ìƒ ë™ì‘.",source_format:"Excel"}
];

// â•â•â•â•â•â•â•â•â•â• UTILS â•â•â•â•â•â•â•â•â•â•
const esc=s=>(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
const badge=r=>{const c=r==='Pass'?'p':r==='Fail'?'f':'c';const ic=r==='Pass'?'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>':r==='Fail'?'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>':'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>';return `<span class="bdg bdg-${c}">${ic} ${r}</span>`};
const fmtB=f=>{const c=f==='PPT'?'ppt':f==='Excel'?'xls':'doc';return `<span class="fmt fmt-${c}"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>${f}</span>`};
const vclr=v=>v==='Pass'?'var(--pass)':v==='Fail'?'var(--fail)':'var(--cond)';

function showBanner(type,msg){const b=document.getElementById('banner');b.className='banner '+(type==='ok'?'ok':type==='err'?'err':'info');b.innerHTML=msg;b.style.display='flex';setTimeout(()=>b.style.display='none',6000)}
function closeModal(){document.getElementById('uploadModal').classList.remove('show')}
function openModal(){document.getElementById('uploadModal').classList.add('show')}

// â•â•â•â•â•â•â•â•â•â• GITHUB API â•â•â•â•â•â•â•â•â•â•
async function loadGitHub(){
  if(!CFG.owner||!CFG.repo){showBanner('info','GitHub ë¯¸ì„¤ì •. ìƒ˜í”Œ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. [ì„¤ì •]ì—ì„œ ì—°ê²°í•˜ì„¸ìš”.');DATA=[...SAMPLE];render();return}
  showBanner('info','<span class="spin"></span> GitHubì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
  try{
    const h={'Accept':'application/vnd.github.v3+json'};if(CFG.token)h['Authorization']='token '+CFG.token;
    const r=await fetch(`https://api.github.com/repos/${CFG.owner}/${CFG.repo}/contents/${CFG.path}?ref=${CFG.branch}&t=${Date.now()}`,{headers:h});
    if(!r.ok){if(r.status===404){showBanner('info','ë°ì´í„° íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”!');DATA=[]}else throw new Error(r.status)}
    else{const f=await r.json();DATA=JSON.parse(decodeURIComponent(escape(atob(f.content.replace(/\n/g,'')))));showBanner('ok',`âœ“ ${DATA.length}ê±´ ë¡œë“œ ì™„ë£Œ`)}
  }catch(e){showBanner('err','GitHub ì—°ë™ ì‹¤íŒ¨: '+e.message+'. ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©.');DATA=[...SAMPLE]}
  render();
}

async function saveGitHub(entry){
  if(!CFG.owner||!CFG.repo||!CFG.token){DATA.push(entry);render();showBanner('ok','âœ“ ë¡œì»¬ ì €ì¥ ì™„ë£Œ. GitHub ì—°ë™ì€ [ì„¤ì •]ì—ì„œ í† í° ì…ë ¥ í•„ìš”.');return true}
  try{
    const h={'Accept':'application/vnd.github.v3+json','Authorization':'token '+CFG.token,'Content-Type':'application/json'};
    let sha=null;
    try{const g=await fetch(`https://api.github.com/repos/${CFG.owner}/${CFG.repo}/contents/${CFG.path}?ref=${CFG.branch}`,{headers:h});if(g.ok){const x=await g.json();sha=x.sha;DATA=JSON.parse(decodeURIComponent(escape(atob(x.content.replace(/\n/g,'')))))}}catch(e){}
    DATA.push(entry);
    const body={message:`[TDSP] Add: ${entry.test_id}`,content:btoa(unescape(encodeURIComponent(JSON.stringify(DATA,null,2)))),branch:CFG.branch};
    if(sha)body.sha=sha;
    const p=await fetch(`https://api.github.com/repos/${CFG.owner}/${CFG.repo}/contents/${CFG.path}`,{method:'PUT',headers:h,body:JSON.stringify(body)});
    if(!p.ok)throw new Error(p.status);
    render();showBanner('ok',`âœ“ GitHub ì»¤ë°‹ ì™„ë£Œ: ${entry.test_id}`);return true;
  }catch(e){showBanner('err','GitHub ì €ì¥ ì‹¤íŒ¨: '+e.message);DATA.push(entry);render();return false}
}

// â•â•â•â•â•â•â•â•â•â• DOWNLOADS â•â•â•â•â•â•â•â•â•â•
function dlJSON(){
  const d=FILTERED.length?FILTERED:DATA;
  const blob=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='tdsp_data.json';a.click();
}
function dlCSV(){
  const d=FILTERED.length?FILTERED:DATA;if(!d.length)return;
  const cols=['test_id','project_name','test_type','test_date','result_summary','engineer_name','source_format','notes','tags'];
  let csv=cols.join(',')+'\n';
  d.forEach(r=>{csv+=cols.map(c=>{let v=r[c];if(Array.isArray(v))v=v.join('; ');return `"${String(v||'').replace(/"/g,'""')}"`}).join(',')+'\n'});
  const blob=new Blob(['\ufeff'+csv],{type:'text/csv;charset=utf-8'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='tdsp_data.csv';a.click();
}
function dlSingle(id){
  const item=DATA.find(d=>d.test_id===id);if(!item)return;
  const blob=new Blob([JSON.stringify(item,null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=id+'.json';a.click();
}

// â•â•â•â•â•â•â•â•â•â• FILTER â•â•â•â•â•â•â•â•â•â•
function filter(){
  const q=(document.getElementById('si')?.value||'').toLowerCase();
  const ft=document.getElementById('ft')?.value||'All';
  const fr=document.getElementById('fr')?.value||'All';
  FILTERED=DATA.filter(d=>{
    const mq=!q||d.project_name.toLowerCase().includes(q)||d.test_id.toLowerCase().includes(q)||(d.tags||[]).some(t=>t.toLowerCase().includes(q))||d.engineer_name.includes(q)||(d.notes||'').toLowerCase().includes(q);
    const mt=ft==='All'||d.test_type===ft;
    const mr=fr==='All'||d.result_summary===fr;
    return mq&&mt&&mr;
  });
  renderData();
}

// â•â•â•â•â•â•â•â•â•â• RENDER NAV â•â•â•â•â•â•â•â•â•â•
function renderNav(){
  const tabs=[
    {k:'dashboard',l:'ëŒ€ì‹œë³´ë“œ',i:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>'},
    {k:'schema',l:'ìŠ¤í‚¤ë§ˆ',i:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="5" rx="1"/><rect x="2" y="10" width="20" height="5" rx="1"/><rect x="2" y="17" width="20" height="5" rx="1"/></svg>'},
    {k:'arch',l:'ì•„í‚¤í…ì²˜',i:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="5" cy="12" r="3"/><circle cx="19" cy="12" r="3"/><line x1="8" y1="12" x2="16" y2="12"/></svg>'},
    {k:'config',l:'ì„¤ì •',i:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9"/></svg>'}
  ];
  document.getElementById('navBar').innerHTML=tabs.map(t=>`<button class="nbtn ${VIEW===t.k?'on':''}" onclick="switchView('${t.k}')">${t.i} ${t.l}</button>`).join('')+
  `<button class="ubtn" onclick="openUpload()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg> ì—…ë¡œë“œ</button>`;
}

function switchView(v){VIEW=v;renderNav();render()}

// â•â•â•â•â•â•â•â•â•â• RENDER MAIN â•â•â•â•â•â•â•â•â•â•
function render(){
  FILTERED=[...DATA];
  const C=document.getElementById('content');
  if(VIEW==='dashboard')renderDashboard(C);
  else if(VIEW==='schema')renderSchema(C);
  else if(VIEW==='arch')renderArch(C);
  else if(VIEW==='config')renderConfig(C);
  else if(VIEW==='detail')renderDetail(C);
}

function renderDashboard(C){
  const tot=DATA.length,pas=DATA.filter(d=>d.result_summary==='Pass').length,fai=DATA.filter(d=>d.result_summary==='Fail').length,con=DATA.filter(d=>d.result_summary==='Conditional').length,prj=[...new Set(DATA.map(d=>d.project_name))].length;
  C.innerHTML=`
    <div class="stats">
      <div class="st"><div class="st-l">ì „ì²´ í…ŒìŠ¤íŠ¸</div><div class="st-v" style="color:var(--t2)">${tot}</div></div>
      <div class="st"><div class="st-l">Pass</div><div class="st-v" style="color:var(--pass)">${pas}</div></div>
      <div class="st"><div class="st-l">Fail</div><div class="st-v" style="color:var(--fail)">${fai}</div></div>
      <div class="st"><div class="st-l">Conditional</div><div class="st-v" style="color:var(--cond)">${con}</div></div>
      <div class="st"><div class="st-l">í”„ë¡œì íŠ¸</div><div class="st-v" style="color:var(--blue)">${prj}</div></div>
    </div>
    <div class="toolbar">
      <button class="dlbtn" onclick="dlJSON()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>JSON ë‹¤ìš´ë¡œë“œ</button>
      <button class="dlbtn" onclick="dlCSV()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>CSV ë‹¤ìš´ë¡œë“œ</button>
      <button class="dlbtn" onclick="loadGitHub()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53A4.48 4.48 0 0 0 12 7.5v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5"/></svg>GitHub ìƒˆë¡œê³ ì¹¨</button>
    </div>
    <div class="sbar">
      <div class="swrap"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg><input class="sinput" id="si" placeholder="í…ŒìŠ¤íŠ¸ ID, í”„ë¡œì íŠ¸ëª…, íƒœê·¸, ì—”ì§€ë‹ˆì–´ ê²€ìƒ‰..." oninput="filter()"></div>
      <select class="fsel" id="ft" onchange="filter()"><option value="All">ì „ì²´ ìœ í˜•</option><option>Functional</option><option>Performance</option><option>Reliability</option><option>Safety</option><option>EMC</option><option>Environmental</option></select>
      <select class="fsel" id="fr" onchange="filter()"><option value="All">ì „ì²´ ê²°ê³¼</option><option>Pass</option><option>Fail</option><option>Conditional</option></select>
      <div class="vtog"><button class="${VMODE==='grid'?'on':''}" onclick="VMODE='grid';filter()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg></button><button class="${VMODE==='list'?'on':''}" onclick="VMODE='list';filter()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/></svg></button></div>
    </div>
    <div class="rcnt" id="rcnt">${FILTERED.length}ê±´</div>
    <div id="dc"></div>`;
  renderData();
}

function renderData(){
  const dc=document.getElementById('dc');const rc=document.getElementById('rcnt');
  if(rc)rc.textContent=FILTERED.length+'ê±´ì˜ í…ŒìŠ¤íŠ¸ ë°ì´í„°';
  if(!dc)return;
  if(!FILTERED.length){dc.innerHTML='<div style="text-align:center;padding:50px;color:var(--t3)">ë°ì´í„° ì—†ìŒ</div>';return}
  if(VMODE==='grid'){
    dc.innerHTML=`<div class="cgrid">${FILTERED.map(d=>`
      <div class="tcard" onclick="showDetail('${d.test_id}')">
        <div class="ch"><div><div class="ct">${esc(d.test_id)}</div><div class="cs">${esc(d.project_name)}</div></div>${badge(d.result_summary)}</div>
        <div class="cm">${fmtB(d.source_format||'Word')}<span>${d.test_type}</span><span class="sep">Â·</span><span>${d.test_date}</span><span class="sep">Â·</span><span>${d.engineer_name}</span></div>
        ${(d.measurements||[]).slice(0,2).map(m=>`<div class="mrow"><span>${m.item}</span><span class="mval" style="color:${vclr(m.verdict)}">${m.value} ${m.unit}</span></div>`).join('')}
        ${(d.measurements||[]).length>2?`<div style="font-size:10px;color:var(--t3);margin-top:2px">+${d.measurements.length-2} more</div>`:''}
        <div class="tags" style="margin-top:8px">${(d.tags||[]).slice(0,4).map(t=>`<span class="tag">${t}</span>`).join('')}</div>
      </div>`).join('')}</div>`;
  }else{
    dc.innerHTML=`<div class="twrap"><table class="dtbl"><thead><tr><th>í…ŒìŠ¤íŠ¸ ID</th><th>í”„ë¡œì íŠ¸</th><th>ìœ í˜•</th><th>ë‚ ì§œ</th><th>ê²°ê³¼</th><th>ì›ë³¸</th><th>ì—”ì§€ë‹ˆì–´</th></tr></thead><tbody>${FILTERED.map(d=>`
      <tr onclick="showDetail('${d.test_id}')">
        <td style="font-family:var(--mono);font-size:12px;color:var(--t1)">${d.test_id}</td>
        <td style="color:var(--t3)">${d.project_name}</td>
        <td style="color:var(--t3)">${d.test_type}</td>
        <td style="color:var(--t3)">${d.test_date}</td>
        <td>${badge(d.result_summary)}</td>
        <td>${fmtB(d.source_format||'Word')}</td>
        <td style="color:var(--t3)">${d.engineer_name}</td>
      </tr>`).join('')}</tbody></table></div>`;
  }
}

// â•â•â•â•â•â•â•â•â•â• DETAIL â•â•â•â•â•â•â•â•â•â•
let DETAIL_ID='';
function showDetail(id){DETAIL_ID=id;VIEW='detail';renderNav();render()}
function backToList(){VIEW='dashboard';renderNav();render()}

function renderDetail(C){
  const d=DATA.find(x=>x.test_id===DETAIL_ID);if(!d){backToList();return}
  C.innerHTML=`<div style="animation:fadeUp .3s ease">
    <button class="dbk" onclick="backToList()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>ëª©ë¡ìœ¼ë¡œ</button>
    <div class="dh"><h2>${esc(d.test_id)}</h2>${badge(d.result_summary)} ${fmtB(d.source_format||'Word')}
      <button class="dlbtn" onclick="dlSingle('${d.test_id}')" style="margin-left:auto"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="13" height="13"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>ë‹¤ìš´ë¡œë“œ</button>
    </div>
    <div class="dgrid">
      <div class="dsec"><div class="stit">ê¸°ë³¸ ì •ë³´</div>${[['í”„ë¡œì íŠ¸',d.project_name],['í…ŒìŠ¤íŠ¸ ìœ í˜•',d.test_type],['í…ŒìŠ¤íŠ¸ ë‚ ì§œ',d.test_date],['ë‹´ë‹¹ ì—”ì§€ë‹ˆì–´',d.engineer_name]].map(([l,v])=>`<div class="irow"><span class="ilbl">${l}</span><span class="ival">${esc(v)}</span></div>`).join('')}</div>
      <div class="dsec"><div class="stit">DUT ì •ë³´</div>${d.dut_info?Object.entries(d.dut_info).map(([k,v])=>`<div class="irow"><span class="ilbl">${k}</span><span class="ival m">${esc(String(v))}</span></div>`).join(''):'<span class="ilbl">ì—†ìŒ</span>'}</div>
      <div class="dsec"><div class="stit">í…ŒìŠ¤íŠ¸ ì¡°ê±´</div>${d.test_conditions?Object.entries(d.test_conditions).map(([k,v])=>`<div class="irow"><span class="ilbl">${k}</span><span class="ival">${esc(String(v))}</span></div>`).join(''):'<span class="ilbl">ì—†ìŒ</span>'}</div>
      <div class="dsec"><div class="stit">ì›ë³¸ íŒŒì¼</div>${(d.original_files||[]).map(f=>`<div class="flink"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>${esc(f)}</div>`).join('')}</div>
      ${(d.measurements||[]).length?`<div class="dsec full"><div class="stit">ì¸¡ì • ê²°ê³¼</div><table class="mtbl"><thead><tr><th>í•­ëª©</th><th>ì¸¡ì •ê°’</th><th>ë‹¨ìœ„</th><th>ê¸°ì¤€</th><th>íŒì •</th></tr></thead><tbody>${d.measurements.map(m=>`<tr><td style="color:var(--t1)">${m.item}</td><td style="font-family:var(--mono);font-size:12px;color:var(--t1)">${m.value}</td><td style="color:var(--t3)">${m.unit}</td><td style="font-family:var(--mono);font-size:12px;color:var(--t2)">${m.spec}</td><td>${badge(m.verdict)}</td></tr>`).join('')}</tbody></table></div>`:''}
      <div class="dsec"><div class="stit">íƒœê·¸</div><div class="tags">${(d.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('')}</div></div>
      <div class="dsec"><div class="stit">ë¹„ê³ </div><div class="ntxt">${esc(d.notes||'ì—†ìŒ')}</div></div>
    </div></div>`;
}

// â•â•â•â•â•â•â•â•â•â• SCHEMA â•â•â•â•â•â•â•â•â•â•
function renderSchema(C){
  const fields=[
    {k:'project_name',t:'String',r:1,d:'í”„ë¡œì íŠ¸ ëª…ì¹­'},{k:'test_id',t:'String (PK)',r:1,d:'ê³ ìœ  í…ŒìŠ¤íŠ¸ ì‹ë³„ì'},
    {k:'test_type',t:'Enum',r:1,d:'Functional, Performance, Reliability, Safety, EMC, Environmental, Other'},
    {k:'test_date',t:'Date',r:1,d:'YYYY-MM-DD'},{k:'dut_info',t:'JSON Object',r:0,d:'model, serial, fw_version ë“±'},
    {k:'test_conditions',t:'JSON Object',r:0,d:'temperature, humidity, voltage ë“±'},
    {k:'result_summary',t:'Enum',r:1,d:'Pass / Fail / Conditional'},
    {k:'measurements',t:'JSON Array',r:0,d:'{item, value, unit, spec, verdict}'},
    {k:'engineer_name',t:'String',r:1,d:'ë‹´ë‹¹ ì—”ì§€ë‹ˆì–´'},{k:'original_files',t:'Array<String>',r:0,d:'ì›ë³¸ íŒŒì¼ëª…'},
    {k:'tags',t:'Array<String>',r:0,d:'ê²€ìƒ‰ìš© íƒœê·¸'},{k:'notes',t:'Text',r:0,d:'ë¹„ê³ '},
    {k:'source_format',t:'String',r:0,d:'PPT / Excel / Word'}
  ];
  C.innerHTML=`<div class="dsec full" style="animation:fadeUp .4s ease">
    <div style="display:flex;align-items:center;gap:9px;margin-bottom:18px"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><rect x="2" y="3" width="20" height="5" rx="1"/><rect x="2" y="10" width="20" height="5" rx="1"/><rect x="2" y="17" width="20" height="5" rx="1"/></svg><h3 style="font-family:var(--sans);font-size:17px;font-weight:700">í‘œì¤€ ë°ì´í„° ìŠ¤í‚¤ë§ˆ v1.0</h3></div>
    <table class="sctbl"><thead><tr><th>í•„ë“œëª…</th><th>íƒ€ì…</th><th>í•„ìˆ˜</th><th>ì„¤ëª…</th></tr></thead><tbody>${fields.map(f=>`<tr><td class="scf">${f.k}</td><td><span class="sct">${f.t}</span></td><td>${f.r?'<span class="scr">â—</span>':''}</td><td style="color:var(--t3)">${f.d}</td></tr>`).join('')}</tbody></table></div>
    <div class="dsec full" style="margin-top:14px;animation:fadeUp .4s ease .1s both"><div class="stit">JSON ìƒ˜í”Œ</div><pre class="codeblock">${esc(JSON.stringify(SAMPLE[0],null,2))}</pre></div>`;
}

// â•â•â•â•â•â•â•â•â•â• ARCHITECTURE â•â•â•â•â•â•â•â•â•â•
function renderArch(C){
  C.innerHTML=`<div class="dsec full" style="animation:fadeUp .4s ease">
    <div style="display:flex;align-items:center;gap:9px;margin-bottom:20px"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><circle cx="5" cy="12" r="3"/><circle cx="19" cy="12" r="3"/><line x1="8" y1="12" x2="16" y2="12"/></svg><h3 style="font-family:var(--sans);font-size:17px;font-weight:700">ë°ì´í„° íŒŒì´í”„ë¼ì¸ & ì•„í‚¤í…ì²˜</h3></div>
    <div class="pflow">${[
      {i:'ğŸ“',t:'Upload',d:'PPT / Excel / Word',c:'var(--blue)'},
      {i:'ğŸ¤–',t:'Parse',d:'Claude AI íŒŒì‹±',c:'var(--accent)'},
      {i:'ğŸ”„',t:'Standardize',d:'JSON ìŠ¤í‚¤ë§ˆ ë§¤í•‘',c:'var(--purple)'},
      {i:'ğŸ’¾',t:'Store',d:'GitHub Repo',c:'var(--pass)'},
      {i:'ğŸŒ',t:'Access',d:'GitHub Pages',c:'#06b6d4'}
    ].map((s,i,a)=>`<div class="pstep"><div class="pico">${s.i}</div><div class="ptit" style="color:${s.c}">${s.t}</div><div class="pdsc">${s.d}</div></div>${i<a.length-1?'<div class="parr">â†’</div>':''}`).join('')}</div></div>
    <div class="agrid">${[
      {t:'Frontend â€” GitHub Pages',c:'var(--blue)',d:'ì •ì  HTMLì„ <code>GitHub Pages</code>ë¡œ í˜¸ìŠ¤íŒ…. ë¬´ë£Œ, ë³„ë„ ì„œë²„ ë¶ˆí•„ìš”.'},
      {t:'Data â€” GitHub Repository',c:'var(--pass)',d:'<code>data/tests.json</code>ì— ì €ì¥. Git ë²„ì „ ê´€ë¦¬ë¡œ ì´ë ¥ ì¶”ì .'},
      {t:'Upload â€” GitHub API',c:'var(--accent)',d:'ì›¹ UIì—ì„œ <code>Contents API</code>ë¡œ ìë™ ì»¤ë°‹. PAT í•„ìš”.'},
      {t:'Download â€” JSON/CSV',c:'var(--purple)',d:'í•„í„°ë§ëœ ë°ì´í„°ë¥¼ <code>JSON</code> ë˜ëŠ” <code>CSV</code>ë¡œ ë‹¤ìš´ë¡œë“œ.'}
    ].map(a=>`<div class="acard"><div class="atit" style="color:${a.c}">${a.t}</div><div class="adsc">${a.d}</div></div>`).join('')}</div>
    <div class="dsec full" style="margin-top:14px"><div class="stit">GitHub ì €ì¥ì†Œ êµ¬ì¡°</div><pre class="codeblock">tdsp-data/
â”œâ”€â”€ index.html          â† ì´ í”Œë«í¼ (GitHub Pages)
â”œâ”€â”€ data/
â”‚   â””â”€â”€ tests.json      â† í‘œì¤€í™”ëœ í…ŒìŠ¤íŠ¸ ë°ì´í„°
â”œâ”€â”€ raw/                â† ì›ë³¸ íŒŒì¼ ë³´ê´€ (ì„ íƒ)
â”‚   â”œâ”€â”€ Report_v1.pptx
â”‚   â””â”€â”€ Data.xlsx
â””â”€â”€ README.md</pre></div>
    <div class="dsec full" style="margin-top:14px"><div class="stit">ë°°í¬ ë°©ë²•</div><div style="color:var(--t2);font-size:13px;line-height:2">
      <b style="color:var(--t1)">1.</b> GitHubì— <code style="background:var(--bg);padding:1px 5px;border-radius:3px;font-family:var(--mono);font-size:11px;color:var(--accent)">tdsp-data</code> ì €ì¥ì†Œ ìƒì„±<br>
      <b style="color:var(--t1)">2.</b> ì´ HTMLì„ <code style="background:var(--bg);padding:1px 5px;border-radius:3px;font-family:var(--mono);font-size:11px;color:var(--accent)">index.html</code>ë¡œ push<br>
      <b style="color:var(--t1)">3.</b> Settings â†’ Pages â†’ Sourceë¥¼ <code style="background:var(--bg);padding:1px 5px;border-radius:3px;font-family:var(--mono);font-size:11px;color:var(--accent)">main</code>ìœ¼ë¡œ ì„¤ì •<br>
      <b style="color:var(--t1)">4.</b> <code style="background:var(--bg);padding:1px 5px;border-radius:3px;font-family:var(--mono);font-size:11px;color:var(--accent)">https://USERNAME.github.io/tdsp-data/</code> ì ‘ì† ê°€ëŠ¥<br>
      <b style="color:var(--t1)">5.</b> í”Œë«í¼ [ì„¤ì •]ì—ì„œ GitHub ì •ë³´ ì…ë ¥ â†’ ë°ì´í„° ì—°ë™ ì™„ë£Œ
    </div></div>`;
}

// â•â•â•â•â•â•â•â•â•â• CONFIG â•â•â•â•â•â•â•â•â•â•
function renderConfig(C){
  C.innerHTML=`<div class="csec"><div style="display:flex;align-items:center;gap:9px;margin-bottom:18px"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83"/></svg><h3 style="font-family:var(--sans);font-size:17px;font-weight:700">GitHub ì—°ë™ ì„¤ì •</h3></div>
    <label class="clbl">GitHub Username</label><input class="cinp" id="co" value="${esc(CFG.owner)}" placeholder="ì˜ˆ: jongtack-byeon">
    <label class="clbl">Repository Name</label><input class="cinp" id="cr" value="${esc(CFG.repo)}" placeholder="ì˜ˆ: tdsp-data">
    <label class="clbl">Branch</label><input class="cinp" id="cb" value="${esc(CFG.branch)}" placeholder="main">
    <label class="clbl">ë°ì´í„° íŒŒì¼ ê²½ë¡œ</label><input class="cinp" id="cp" value="${esc(CFG.path)}" placeholder="data/tests.json">
    <div class="chint">repo ë‚´ JSON ë°ì´í„° íŒŒì¼ì˜ ê²½ë¡œ</div>
    <label class="clbl">Personal Access Token (ì“°ê¸°ìš©, ì„ íƒ)</label><input class="cinp" id="ct" type="password" value="${esc(CFG.token)}" placeholder="ghp_xxxxxxxxxxxx">
    <div class="chint">GitHub â†’ Settings â†’ Developer settings â†’ Personal access tokens â†’ ê¶Œí•œ: <code style="background:var(--bg);padding:1px 5px;border-radius:3px;font-family:var(--mono);font-size:10px;color:var(--accent)">repo</code></div>
    <button class="cbtn" onclick="saveCfg()">ì„¤ì • ì €ì¥ ë° ì—°ê²° í…ŒìŠ¤íŠ¸</button></div>`;
}
function saveCfg(){
  CFG.owner=document.getElementById('co').value.trim();
  CFG.repo=document.getElementById('cr').value.trim();
  CFG.branch=document.getElementById('cb').value.trim()||'main';
  CFG.path=document.getElementById('cp').value.trim()||'data/tests.json';
  CFG.token=document.getElementById('ct').value.trim();
  localStorage.setItem('tdsp_cfg',JSON.stringify(CFG));
  showBanner('ok','âœ“ ì„¤ì • ì €ì¥ ì™„ë£Œ');setTimeout(()=>loadGitHub(),300);
}

// â•â•â•â•â•â•â•â•â•â• UPLOAD FORM â•â•â•â•â•â•â•â•â•â•
function openUpload(){
  document.getElementById('modalTitle').textContent='í…ŒìŠ¤íŠ¸ ë°ì´í„° ë“±ë¡';
  document.getElementById('modalBody').innerHTML=`
    <form onsubmit="submitData(event)">
      <div class="frow"><div class="fg"><label class="fl">í”„ë¡œì íŠ¸ëª… *</label><input class="fi" id="up" required placeholder="Galaxy S26 Ultra"></div><div class="fg"><label class="fl">í…ŒìŠ¤íŠ¸ ID *</label><input class="fi" id="uid" required placeholder="GSU-FUNC-2026-006"></div></div>
      <div class="frow"><div class="fg"><label class="fl">í…ŒìŠ¤íŠ¸ ìœ í˜• *</label><select class="fi" id="uty" required><option value="">ì„ íƒ</option><option>Functional</option><option>Performance</option><option>Reliability</option><option>Safety</option><option>EMC</option><option>Environmental</option><option>Other</option></select></div><div class="fg"><label class="fl">í…ŒìŠ¤íŠ¸ ë‚ ì§œ *</label><input type="date" class="fi" id="udt" required></div></div>
      <div class="frow"><div class="fg"><label class="fl">ê²°ê³¼ *</label><select class="fi" id="urs" required><option value="">ì„ íƒ</option><option>Pass</option><option>Fail</option><option>Conditional</option></select></div><div class="fg"><label class="fl">ë‹´ë‹¹ ì—”ì§€ë‹ˆì–´ *</label><input class="fi" id="uen" required placeholder="ë³€ì¢…íƒ"></div></div>
      <div class="fg"><label class="fl">DUT ì •ë³´ (JSON)</label><input class="fi" id="udi" style="font-family:var(--mono);font-size:11.5px" placeholder='{"model":"SM-S926B","serial":"...","fw_version":"..."}'></div>
      <div class="fg"><label class="fl">í…ŒìŠ¤íŠ¸ ì¡°ê±´ (JSON)</label><input class="fi" id="utc" style="font-family:var(--mono);font-size:11.5px" placeholder='{"temperature":"25Â°C","humidity":"50%RH"}'></div>
      <div class="fg"><label class="fl">ì¸¡ì •ê°’ (JSON Array)</label><textarea class="fta" id="ume" placeholder='[{"item":"Boot Time","value":2.3,"unit":"sec","spec":"< 3.0","verdict":"Pass"}]'></textarea></div>
      <div class="frow"><div class="fg"><label class="fl">ì›ë³¸ íŒŒì¼ëª…</label><input class="fi" id="uof" placeholder="Report.pptx, Data.xlsx"></div><div class="fg"><label class="fl">ì›ë³¸ í¬ë§·</label><select class="fi" id="usf"><option>PPT</option><option>Excel</option><option>Word</option></select></div></div>
      <div class="fg"><label class="fl">íƒœê·¸ (ì‰¼í‘œ êµ¬ë¶„)</label><input class="fi" id="utg" placeholder="Galaxy, S26, Functional"></div>
      <div class="fg"><label class="fl">ë¹„ê³ </label><textarea class="fta" id="uno" style="font-family:var(--kr);font-size:12.5px" placeholder="íŠ¹ì´ì‚¬í•­..."></textarea></div>
      <button type="submit" class="fsub" id="sbtn">ë°ì´í„° ì €ì¥</button>
    </form>`;
  openModal();
}

function tryJSON(s){try{return JSON.parse(s)}catch(e){return null}}

async function submitData(e){
  e.preventDefault();
  const btn=document.getElementById('sbtn');btn.disabled=true;btn.textContent='ì €ì¥ ì¤‘...';
  const entry={
    test_id:document.getElementById('uid').value.trim(),
    project_name:document.getElementById('up').value.trim(),
    test_type:document.getElementById('uty').value,
    test_date:document.getElementById('udt').value,
    result_summary:document.getElementById('urs').value,
    engineer_name:document.getElementById('uen').value.trim(),
    dut_info:tryJSON(document.getElementById('udi').value)||{},
    test_conditions:tryJSON(document.getElementById('utc').value)||{},
    measurements:tryJSON(document.getElementById('ume').value)||[],
    original_files:document.getElementById('uof').value.split(',').map(s=>s.trim()).filter(Boolean),
    source_format:document.getElementById('usf').value,
    tags:document.getElementById('utg').value.split(',').map(s=>s.trim()).filter(Boolean),
    notes:document.getElementById('uno').value.trim()
  };
  await saveGitHub(entry);
  closeModal();
}

// â•â•â•â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â•â•â•â•
renderNav();
loadGitHub();
</script>
</body>
</html>
